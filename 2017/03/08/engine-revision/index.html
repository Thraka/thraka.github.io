<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">

  
  <title>Engine Revision | Thraka&#39;s Home</title>
  
  <meta name="author" content="Thraka">
  
  <meta name="description" content="Over the last two months I’ve spent a lot of time looking at how SadConsole is put together. Specifically, paying attention to namespaces and class names. There a few complexities in the object model that I wanted to address and just make things simpler. I’ve come to a point now where I would guess that I’m 99% complete on implementing these changes, and I’m extremely happy with how things have turned out.
Two major changes that I’ve figured out impact you as a coder.

All four libraries (Core, Ansi, Controls, GameHelpers) have been merged into a single library: SadConsole.dll.
Instead of two libraries, one for OpenGl and one for DirectX, a single library handles both.

Originally I thought I needed both types of libraries, however it turns out that you (creating the game) choose which target (OpenGL or DirectX) based on which MonoGame you choose. SadConsole will just play along without a problem.
The internal rendering and processing system has also changed.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Engine Revision"/>
  <meta property="og:site_name" content="Thraka&#39;s Home"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-76753055-1', 'auto');
  ga('send', 'pageview');
</script>




</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Thraka&#39;s Home</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
            
            <a href="/blog" title="All the articles">
            
			  <i class=""></i>Blog
			</a>
		  </li>
		  
		  <li>
            
            <a href="/docs" title="Documentation for SadConsole">
            
			  <i class=""></i>Documentation
			</a>
		  </li>
		  
		  <li>
            
			<a href="https://github.com/thraka/sadconsole" title="SadConsole GitHub">
            
			  <i class="fa fa-github"></i>Github
			</a>
		  </li>
		  
		  <li>
            
			<a href="https://www.reddit.com/r/sadconsole/" title="SadConsole SubReddit">
            
			  <i class="fa fa-reddit"></i>Reddit
			</a>
		  </li>
		  
		  <li>
            
            <a href="/atom.xml" title="Subscribe">
            
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Engine Revision</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>Over the last two months I’ve spent a lot of time looking at how SadConsole is put together. Specifically, paying attention to namespaces and class names. There a few complexities in the object model that I wanted to address and just make things simpler. I’ve come to a point now where I would guess that I’m 99% complete on implementing these changes, and I’m extremely happy with how things have turned out.</p>
<p>Two major changes that I’ve figured out impact you as a coder.</p>
<ol>
<li>All four libraries (Core, Ansi, Controls, GameHelpers) have been merged into a single library: <code>SadConsole.dll</code>.</li>
<li>Instead of two libraries, one for OpenGl and one for DirectX, a single library handles both.</li>
</ol>
<p>Originally I thought I needed both types of libraries, however it turns out that you (creating the game) choose which target (OpenGL or DirectX) based on which MonoGame you choose. SadConsole will just play along without a problem.</p>
<p>The internal rendering and processing system has also changed.</p>
<a id="more"></a>
<p>Here are the notes from the readme.</p>
<p>The preview release NuGet package is at <a href="https://www.nuget.org/packages/SadConsole/" target="_blank" rel="noopener">https://www.nuget.org/packages/SadConsole/</a></p>
<p>A lot of refactoring has happened. Many of the types in SadConsole have been moved around to a more logical position and a lot of redundancy has been removed.</p>
<p>For example, the <strong>Console</strong> type used to be located at the <code>SadConsole.Consoles.Console</code> which felt very obtuse. <strong>Console</strong> is a core type that doesn’t need its own namespace, much like <strong>Cell</strong>. This type is now located in the root namespace <code>SadConsole</code>.</p>
<p>Other things have simplified naming too, like <code>Console.CanUseKeyboard</code> is just <code>Console.UseKeyboard</code> now.</p>
<h2 id="core-engine"><a class="markdownIt-Anchor" href="#core-engine"></a> Core engine</h2>
<p><code>SadConsole.Engine</code> has been removed. Its role was to coordinate all the parts of SadConsole. Instead this has been split into three parts, <code>SadConsole.Global</code> which represents state (time passed, keyboard/mouse, current thing to render), <code>SadConsole.Game</code> which is the <code>MonoGame.Game</code> instance, and <code>SadConsole.Settings</code> which provides full screen, toggle drawing on/off etc.</p>
<table>
<thead>
<tr>
<th>Class</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>SadConsole.Global</td>
<td>Global state, like time elapsed, keyboard/mouse input state, the active thing to render.</td>
</tr>
<tr>
<td>SadConsole.Game</td>
<td><code>Microsoft.Xna.Framework.Game</code> game instance that you can run instead of providing your own.</td>
</tr>
<tr>
<td>SadConsole.Settings</td>
<td>Various settings like fullscreen, device clear color, enable/disable keyboard or mouse, other settings.</td>
</tr>
</tbody>
</table>
<h2 id="core-types"><a class="markdownIt-Anchor" href="#core-types"></a> Core types</h2>
<p>The <code>SadConsole.Consoles</code> namespace does not exist anymore and is instead broken up into two different namespaces that better represents the types contained in it:</p>
<table>
<thead>
<tr>
<th>Namespace</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>SadConsole.Surfaces</td>
<td>All types of surfaces that are attached to a Console.</td>
</tr>
<tr>
<td>SadConsole.Renderers</td>
<td>All renderers that render surfaces and are attached to a Console.</td>
</tr>
</tbody>
</table>
<p>The <strong>TextSurface</strong> naming convention has been simplified to <strong>Surface</strong>. And some of the interface and base class complexity of the <strong>TextSurface</strong> stuff has been simplified into fewer types.</p>
<h2 id="rendering"><a class="markdownIt-Anchor" href="#rendering"></a> Rendering</h2>
<p>The rendering system in SadConsole has had some improvements. Instead of each ** Renderer**  having its own ** SpriteBatch** , there is a single <code>SadConosle.Global.SpriteBatch</code> which is reused by all renderers. This reduces memory and reduces CPU cycles that were wasted every time a renderer was created.</p>
<p>Each <strong>Surface</strong> now provides a <strong>RenderTarget2D</strong> type which is a texture. Whenever a surface is rendered, it is drawn onto this texture. At the end of the global Draw call, all surfaces that are in the drawing pipeline are rendered to a single <strong>RenderTarget2D</strong> texture at <code>SadConsole.Global.RenderOutput</code>. This final texture (which contains all drawing from SadConsole) is then drawn to the screen. This simplifies fullscreen and stretch modes. This new system also allows anyone to bypass any part of SadConsole rendering and use the rendered textures to draw on any sort of 3D model or scene of their game. For example, you could build up a 3D scene of an old computer terminal and then use SadConsole on the screen of the computer.</p>
<p>The rendering system is now completely cached. Each <strong>ISurface</strong> type has a <strong>IsDirty</strong> flag which causes the backing <strong>RenderTarget2D</strong> to be updated.</p>
<h2 id="notable-types"><a class="markdownIt-Anchor" href="#notable-types"></a> Notable types</h2>
<p>Here is a list of types that have changed and what replaced them. The root <code>SadConsole</code> namespace is implied in all of these.</p>
<table>
<thead>
<tr>
<th>Old Class</th>
<th>New Class</th>
</tr>
</thead>
<tbody>
<tr>
<td>Engine</td>
<td>Replaced by <strong>Global</strong>, <strong>Game</strong>, and <strong>Settings</strong>.</td>
</tr>
<tr>
<td>ICellAppearance</td>
<td>Removed - Use <strong>Cell</strong>.</td>
</tr>
<tr>
<td>CellAppearance</td>
<td>Removed - Use <strong>Cell</strong>.</td>
</tr>
<tr>
<td>Consoles.IConsole</td>
<td>IConsole. Still exists, implements <strong>IScreen</strong> now.</td>
</tr>
<tr>
<td>Consoles.IConsoleList</td>
<td>Removed.</td>
</tr>
<tr>
<td>Consoles.Console</td>
<td>Console</td>
</tr>
<tr>
<td>Consoles.ConsoleList</td>
<td>Removed. All <strong>IScreen</strong> types have both <strong>Parent</strong> and <strong>Children</strong> properties.</td>
</tr>
<tr>
<td>Consoles.ITextSurface</td>
<td>Surfaces.ISurface</td>
</tr>
<tr>
<td>Consoles.TextSurfaceBasic</td>
<td>Removed. Merged into <strong>Surfaces.Surface</strong></td>
</tr>
<tr>
<td>Consoles.TextSurface</td>
<td>Surfaces.BasicSurface</td>
</tr>
<tr>
<td>Consoles.TextSurfaceView</td>
<td>Surfaces.SurfaceView</td>
</tr>
<tr>
<td>Consoles.AnimatedTextSurface</td>
<td>Surfaces.AnimatedSurface</td>
</tr>
<tr>
<td>Consoles.LayeredTextSurface</td>
<td>Surfaces.LayeredSurface</td>
</tr>
<tr>
<td>Consoles.Cursor</td>
<td>Cursor</td>
</tr>
<tr>
<td>Consoles.SurfaceEditor</td>
<td>Surfaces.SurfaceEditor</td>
</tr>
<tr>
<td>Consoles.ITextSurfaceRenderer</td>
<td>Renderers.ISurfaceRenderer</td>
</tr>
<tr>
<td>Consoles.TextSurfaceRenderer</td>
<td>Renderers.SurfaceRenderer</td>
</tr>
<tr>
<td>Consoles.LayeredTextRenderer</td>
<td>Renderers.LayeredSurfaceRenderer</td>
</tr>
<tr>
<td>Consoles.ITextSurfaceRendererUpdate</td>
<td>Removed - All surfaces support cached rendering.</td>
</tr>
<tr>
<td>Consoles.CachedTextSurfaceRenderer</td>
<td>Removed - All surfaces support cached rendering.</td>
</tr>
<tr>
<td>Input.MouseInfo</td>
<td>Renamed to Input.Mouse</td>
</tr>
<tr>
<td>Input.KeyboardInfo</td>
<td>Renamed to Input.Keyboard</td>
</tr>
</tbody>
</table>
<p>Besides the <strong>Consoles</strong> namespace, startup, and <strong>Engine</strong> -&gt; <strong>Global</strong> changes, not much else has changed.</p>
<p>Some methods and/or properties have been renamed. Here are some of them.</p>
<table>
<thead>
<tr>
<th>Old name</th>
<th>New name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Input.Keyboard.ProcessKeys</td>
<td>Input.Keyboard.Process</td>
</tr>
<tr>
<td>Input.Mouse.ProcessMouse</td>
<td>Input.Mouse.Process</td>
</tr>
<tr>
<td>Engine.ActiveConsole</td>
<td>Global.InputTargets – This is a new type that allows a Push/Pop/Set system for who gets keyboard/exclusive mouse input</td>
</tr>
</tbody>
</table>
<h2 id="input"><a class="markdownIt-Anchor" href="#input"></a> Input</h2>
<p>Input has been overhauled a bit. Keyboard is mostly the same except for some minor method refactoring. Mouse has change a lot. Previously each console evaluated mouse state for itself. This is no longer how mouse input works. Instead mouse input is driven by the <code>SadConsole.Input.Mouse.Update</code> method which cycles through the <code>SadConsole.Global.Screen</code> gathering all console types. Then, each console has the <code>ProcessMouse</code> method called. If <code>true</code> is returned, mouse processing stops. This happens unless the <code>Global.InputTargets.Console</code> has the <code>IsExclusiveMouse</code> property set to <code>true</code>. If <code>true</code>, mouse is always sent to this console and never to anything else.</p>
<h2 id="startup-code"><a class="markdownIt-Anchor" href="#startup-code"></a> Startup code</h2>
<p>The code to start SadConsole from a dedicated SadConsole project is pretty much the same. But now that <code>Engine</code> is gone, <code>Global</code> is used and the names of the draw/update events are simplier. They also are direct delegates instead of event.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Setup the engine and creat the main window.</span></span><br><span class="line">    SadConsole.Game.Create(<span class="string">"IBM.font"</span>, <span class="number">80</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hook the start event so we can add consoles to the system.</span></span><br><span class="line">    SadConsole.Game.OnInitialize = Init;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hook the update event that happens each frame so we can trap keys and respond.</span></span><br><span class="line">    SadConsole.Game.OnUpdate = Update;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hook the "after render" even though we're not using it.</span></span><br><span class="line">    SadConsole.Game.OnDraw = DrawFrame;</span><br><span class="line">            </span><br><span class="line">    <span class="comment">// Start the game.</span></span><br><span class="line">    SadConsole.Game.Instance.Run();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Code here will not run until the game has shut down.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DrawFrame</span>(<span class="params">GameTime time</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Custom drawing. You don't usually have to do this.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">GameTime time</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Called each logic update.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Any setup</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2017/03/18/engine-revision-completed/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Next</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2016/08/12/easier-startup/" type="button" class="btn btn-default ">Prev<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
    <h2 class="title">Comments</h2>

    
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                
            var disqus_config = function () {
                this.page.url = "http://www.sadconsole.com/2017/03/08/engine-revision/"; // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = "2017/03/08/engine-revision/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
                 
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = '//sadconsoleblog.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div>
    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2017-03-08 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/SadConsole/">SadConsole<span>13</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/SadConsole/">SadConsole<span>13</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2019 Thraka
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
