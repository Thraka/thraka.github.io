<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Thoughts on rendering a console | Thraka&#39;s Home</title>
  <meta name="author" content="Thraka">
  
  <meta name="description" content="The more and more that I use SadConsole on my own little games, the more I grow to dislike the way I render to the screen. Now, I don’t mean specifically the rendering code itself. It’s pretty good, though I have an improvement coming soon. What I mean is the way you, say from a console, get your data rendered to the screen.
A console generally has two roles, it either reads input from the user (providing visual feedback) and/or it presents characters to the user. However, the capabilities you want in drawing characters to the screen may vary. You may:

Use a standard Width x Height console.
Use a bigger console and allow scrolling.
Use a single console the entire time.
Use many different consoles positioned on the screen.
A console that has multiple layers.
A console with a bunch of extra metadata.
A console for UI controls.
A floating window console.
An animated console (entity).

I think that is all the types provided by SadConsole. Here is a diagram of (out of all the libraries for SadConsole) the way the classes are structured.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Thoughts on rendering a console"/>
  <meta property="og:site_name" content="Thraka&#39;s Home"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-76753055-1', 'auto');
  ga('send', 'pageview');
</script>




</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Thraka&#39;s Home</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
            
            <a href="/blog" title="All the articles">
            
			  <i class=""></i>Blog
			</a>
		  </li>
		  
		  <li>
            
            <a href="/docs" title="Documentation for SadConsole">
            
			  <i class=""></i>Documentation
			</a>
		  </li>
		  
		  <li>
            
			<a href="https://github.com/thraka/sadconsole" title="SadConsole GitHub">
            
			  <i class="fa fa-github"></i>Github
			</a>
		  </li>
		  
		  <li>
            
			<a href="https://www.reddit.com/r/sadconsole/" title="SadConsole SubReddit">
            
			  <i class="fa fa-reddit"></i>Reddit
			</a>
		  </li>
		  
		  <li>
            
            <a href="/atom.xml" title="Subscribe">
            
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Thoughts on rendering a console</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>The more and more that I use <strong>SadConsole</strong> on my own little games, the more I grow to dislike the way I render to the screen. Now, I don’t mean specifically the rendering code itself. It’s pretty good, though I have an improvement coming soon. What I mean is the way you, say from a console, get your data rendered to the screen.</p>
<p>A console generally has two roles, it either reads input from the user (providing visual feedback) and/or it presents characters to the user. However, the capabilities you want in drawing characters to the screen may vary. You may:</p>
<ul>
<li>Use a standard Width x Height console.</li>
<li>Use a bigger console and allow scrolling.</li>
<li>Use a single console the entire time.</li>
<li>Use many different consoles positioned on the screen.</li>
<li>A console that has multiple layers.</li>
<li>A console with a bunch of extra metadata.</li>
<li>A console for UI controls.</li>
<li>A floating window console.</li>
<li>An animated console (entity).</li>
</ul>
<p>I think that is all the types provided by <strong>SadConsole</strong>. Here is a diagram of (out of all the libraries for SadConsole) the way the classes are structured.</p>
<img src="/2016/04/23/thoughts-on-rendering-a-console/cellsrenderer-class.png" title="animated static ascii">
<a id="more"></a>
<p>The <code>CellsRenderer</code> type is what actually does the drawing to the screen. All the other classes that inherit it (or inherit from <code>Console</code>) are really specialty classes that are about how a console operates.</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td>CellsRenderer</td>
<td>Handles drawing data to the screen.<br>Manages viewport and scrolling.<br>Manages cell effects.</td>
</tr>
<tr>
<td>Console</td>
<td>Implements input keyboard handling.<br>Provides a cursor for input.<br></td>
</tr>
<tr>
<td>LayeredConsole</td>
<td>Inherits from Console.<br>Provides layering.</td>
</tr>
<tr>
<td>ControlsConsole</td>
<td>Inherits from Console.<br>Supports rendering UI controls.</td>
</tr>
<tr>
<td>Window</td>
<td>Inherits from ControlsConsole, Console.<br>A bordered, title, movable console.<br>Modal or non-modal.</td>
</tr>
<tr>
<td>GameConsole</td>
<td>Inherits from LayeredConsole.<br>Adds a metadata system to attach data to cells.</td>
</tr>
<tr>
<td>Entity</td>
<td>Standalone console supporting animation.</td>
</tr>
</tbody>
</table>
<h2 id="why-this-is-bad"><a class="markdownIt-Anchor" href="#why-this-is-bad"></a> Why this is bad</h2>
<p>Now where things get messy is in cases like the <strong>Entity</strong> or a <strong>Window</strong> type. These console types shouldn’t support scrolling. You don’t make an entity that is bigger than the screen and only render a subset of it at a time. The same for a window. A window is meant to be totally visible on the screen. (the UI system supports hooking up scroll bars and things)</p>
<p>So what happens to an entity when you adjust the viewport to only render a subset of the cells? Nothing bad mind you, but you may not get what you expected. Especially when the entity is animating and flipping through multiple cell surfaces that have completely different sets of cells.</p>
<p>The problem is that the <strong>CellsRenderer</strong> type supports all these rendering systems out of the box, it’s a jack-of-all-trades. Which is great for flexibility, but it puts a strain on the developer to deeply understand the behavior of the types and not mess something up.</p>
<h3 id="the-entity"><a class="markdownIt-Anchor" href="#the-entity"></a> The entity</h3>
<p>The way the entity works is it uses an animation type. The animation is a bunch of frames (CellData classes) and each frame is presented as the <em>current frame</em> during rendering. If the <em>current frame</em> hasn’t changed, the <strong>CellsRenderer</strong> doesn’t check for which cells to render, it already has them cached.</p>
<h3 id="back-to-the-problem"><a class="markdownIt-Anchor" href="#back-to-the-problem"></a> Back to the problem</h3>
<p>Now I ran into a situation where even myself, the one most familiar with the code, was confused as to why my entity wasn’t rendering correctly. What I had done is resized the animation of an entity, which just resizes the CellData of all the animation’s frames. The <em>current frame</em> class reference hadn’t changed, but the size of the frame did. So when the <strong>CellsRenderer</strong> went to render the old 1x1 console, it only drew the top-left cell even though the CellsSurface was much bigger. Ouch. The fix was just to force a recalculation after I resized the animation.</p>
<p>Now with an entity, all this viewport rect rendering stuff doesn’t matter. So the system that is in place for other consoles was stepping on the simpler entity rendering.</p>
<p>Well, I want this library to be easy to work with, so I think I need to separate out functionality out either into components, or specialized consoles. And then for when rendering systems must be different, specialized rendering. I’m not sure what it will look like, but I want to make sure it is easier for others to work with.</p>
<p>There are some awesome .NET console game libraries (like <a href="https://bitbucket.org/clarktravism/rlnet/" target="_blank" rel="noopener">RLNET</a> and <a href="https://github.com/derrickcreamer/SunshineConsole" target="_blank" rel="noopener">SunShine Console</a>) out there much like mine that are quick and easy to use. That is something I want for SadConsole. I think I’ve gotten part of the way there though with NuGet. But more can be done…</p>
<p>… Stay tuned …</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2016/06/01/cached-console/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Next</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2016/04/21/entity-animation-bug/" type="button" class="btn btn-default ">Prev<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
    <h2 class="title">Comments</h2>

    
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                
            var disqus_config = function () {
                this.page.url = "http://www.sadconsole.com/2016/04/23/thoughts-on-rendering-a-console/"; // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = "2016/04/23/thoughts-on-rendering-a-console/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
                 
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = '//sadconsoleblog.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div>
    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-04-23 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/SadConsole/">SadConsole<span>10</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/SadConsole/">SadConsole<span>10</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2018 Thraka
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
