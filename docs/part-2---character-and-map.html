<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Roguelike Tutorial - Part 2 - Character and Map | Thraka</title>
  <meta name="author" content="Thraka">
  
  <meta name="description" content="In this article we’ll accomplish the following:

 Create objects to represent the player.
 Create map tiles and a map.
 Display a map and player on th">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Roguelike Tutorial - Part 2 - Character and Map"/>
  <meta property="og:site_name" content="Thraka"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-76753055-1', 'auto');
  ga('send', 'pageview');
</script>




</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Thraka</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
            
            <a href="/blog" title="All the articles">
            
			  <i class=""></i>Blog
			</a>
		  </li>
		  
		  <li>
            
            <a href="/docs" title="Documentation for SadConsole">
            
			  <i class=""></i>Documentation
			</a>
		  </li>
		  
		  <li>
            
			<a href="https://github.com/thraka/sadconsole" title="SadConsole GitHub">
            
			  <i class="fa fa-github"></i>Github
			</a>
		  </li>
		  
		  <li>
            
			<a href="https://www.reddit.com/r/sadconsole/" title="SadConsole SubReddit">
            
			  <i class="fa fa-reddit"></i>Reddit
			</a>
		  </li>
		  
		  <li>
            
            <a href="/atom.xml" title="Subscribe">
            
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 
	
		<div class="page-header">
			<h1> Roguelike Tutorial - Part 2 - Character and Map</h1>
		</div>
	



<div class="row page">
	<!-- cols -->
	
	<div class="col-md-12">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>In this article we’ll accomplish the following:</p>
<ul>
<li style="list-style: none"><input type="checkbox" checked> Create objects to represent the player.</li>
<li style="list-style: none"><input type="checkbox" checked> Create map tiles and a map.</li>
<li style="list-style: none"><input type="checkbox" checked> Display a map and player on the screen.</li>
<li style="list-style: none"><input type="checkbox" checked> Use the keyboard to move the player.</li>
</ul>
<h5 id="Tutorial-index"><a href="#Tutorial-index" class="headerlink" title="Tutorial index"></a>Tutorial index</h5><ul>
<li><a href="part-1---create-a-new-project.html">Part 1 - Create the project</a></li>
<li><strong>Part 2 - Character and map</strong></li>
<li><a href="part-3---map-generation.html">Part 3 - Map generation</a></li>
<li>More coming soon…</li>
</ul>
<p><a href="sadconsole-rogueliketutorial.zip">Download the source code for the entire series</a>.</p>
<h2 id="Create-an-entity"><a href="#Create-an-entity" class="headerlink" title="Create an entity"></a>Create an entity</h2><p>In a lot of text engines where you want to move characters around a console, you get some additional overhead. Normally, you print the character on the console. Then, when it moves, you redraw it in the new position. After that, you also have to make sure to restore whatever was under the original spot of the character.</p>
<p>SadConsole can avoid that with the <code>SadConsole.GameHelpers.GameObject</code> type. This type provides a positionable text object that can also be animated. The <code>GameObject</code> is used when you have a bunch of moving objects that are layered on top of a background.</p>
<p>We’ll create a class named <code>EntityBase.cs</code> that represents things placed on the map. Right-click on the project file and choose <strong>New</strong> &gt; <strong>Add Folder</strong> and name it <code>Entities</code>. Right-click on the new folder and choose <strong>New</strong> &gt; <strong>Class…</strong> and name the class <code>EntityBase.cs</code>. In this class we’ll inherit from <code>SadConsole.GameHelpers.GameObject</code>. This will represent the base class for monsters, the player, things like that.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SadRogue.Entities</span></span><br><span class="line">&#123;</span><br><span class="line">    class EntityBase: SadConsole.GameHelpers.GameObject</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EntityBase</span>(<span class="params">Color foreground, Color background, <span class="keyword">int</span> glyph</span>) : <span class="title">base</span>(<span class="params"><span class="number">1</span>, <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Animation.CurrentFrame[<span class="number">0</span>].Foreground = foreground;</span><br><span class="line">            Animation.CurrentFrame[<span class="number">0</span>].Background = background;</span><br><span class="line">            Animation.CurrentFrame[<span class="number">0</span>].Glyph = glyph;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveBy</span>(<span class="params">Point change, Map map</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Position += change;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you noticed, there is a <code>MoveBy</code> method on the <code>EntityBase.cs</code> class. This will adjust the position of the entity by the amount provided. It will be easy to move something X or Y spaces on the map. The <code>Map</code> class doesn’t exist yet, we’ll fix that soon.</p>
<p>Next, add another class to the <code>Entities</code> folder named <code>Player.cs</code>. This class will represent the character the player controls in your game.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SadRogue.Entities</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Player</span> : <span class="title">EntityBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Player</span>(<span class="params"></span>): <span class="title">base</span>(<span class="params">Color.Yellow, Color.Black, <span class="string">'@'</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Create-a-map"><a href="#Create-a-map" class="headerlink" title="Create a map"></a>Create a map</h2><p>Now that we have a player that will be contolled on a map, we need to create a class to hold information about the game map. We also need a class to handle drawing the map.</p>
<h3 id="Tiles"><a href="#Tiles" class="headerlink" title="Tiles"></a>Tiles</h3><p>First, we need to create objects that make up the map. A map is a grid of these objects. Some things on the map will block the player (using our movement checks) and others will represent empty space. Add another folder to the solution named <code>MapObjects</code>. This folder will have each tile type that is used to make up a map. the types of tiles placed on the map.</p>
<p>Add a class to that folder named <code>TileBase.cs</code> and add this code. This class inherits from <code>SadConsole.Cell</code> which is a class that all surfaces use in rendering.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> SadConsole;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SadRogue.MapObjects</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">TileBase</span>: <span class="title">Cell</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> IsBlockingMove;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> IsBlockingLOS;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TileBase</span>(<span class="params">Color foreground, Color background, <span class="keyword">int</span> glyph</span>) : <span class="title">base</span>(<span class="params">foreground, background, glyph</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Add two more classes to the <code>MapObjects</code> folder named <code>Wall.cs</code> and <code>Floor.cs</code>. These classes inherit from our new <code>TileBase</code> class and sets it up with.. well.. wall things.</p>
<blockquote>
<p><strong>Wall.cs</strong></p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SadRogue.MapObjects</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Wall</span> : <span class="title">TileBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Wall</span>(<span class="params"></span>) : <span class="title">base</span>(<span class="params">Color.White, Color.Gray, <span class="number">176</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            IsBlockingLOS = <span class="literal">true</span>;</span><br><span class="line">            IsBlockingMove = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Floor.cs</strong></p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SadRogue.MapObjects</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Floor</span> : <span class="title">TileBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Floor</span>(<span class="params"></span>) : <span class="title">base</span>(<span class="params">new Color(<span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span></span>), Color.Black, 46)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            IsBlockingLOS = <span class="literal">false</span>;</span><br><span class="line">            IsBlockingMove = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now that we have tiles, we need a map class to hold them. Add a new class to the root of the project named <code>Map.cs</code>.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.ObjectModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SadRogue</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Map</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> Width &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> Height &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> ObservableCollection&lt;Entities.EntityBase&gt; Entities;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> MapObjects.TileBase[] Tiles;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Map</span>(<span class="params"><span class="keyword">int</span> width, <span class="keyword">int</span> height</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Width = width;</span><br><span class="line">            Height = height;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create our tiles for the map</span></span><br><span class="line">            Tiles = <span class="keyword">new</span> MapObjects.TileBase[width * height];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Fill the map with floors.</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Tiles.Length; i++)</span><br><span class="line">                Tiles[i] = <span class="keyword">new</span> MapObjects.Floor();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set some temp walls, will be replaced by random generation</span></span><br><span class="line">            <span class="comment">// y * width + x = index of that x,y combination</span></span><br><span class="line">            Tiles[<span class="number">5</span> * width + <span class="number">5</span>] = <span class="keyword">new</span> MapObjects.Wall();</span><br><span class="line">            Tiles[<span class="number">2</span> * width + <span class="number">5</span>] = <span class="keyword">new</span> MapObjects.Wall();</span><br><span class="line">            Tiles[<span class="number">10</span> * width + <span class="number">29</span>] = <span class="keyword">new</span> MapObjects.Wall();</span><br><span class="line">            Tiles[<span class="number">17</span> * width + <span class="number">44</span>] = <span class="keyword">new</span> MapObjects.Wall();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Holds all entities on the map</span></span><br><span class="line">            Entities = <span class="keyword">new</span> ObservableCollection&lt;SadRogue.Entities.EntityBase&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I put in code comments to help explain things, but here is some more information. SadConsole can take an array of <code>Cell</code> types, and use that to create a surface that is drawn on the screen. If you remember, our <code>TileBase</code> class inherits from <code>Cell</code>. This new map type has an array of <code>TileBase</code> objects and we can use that to make up each x,y position in the map. And we can use SadConsole to draw those. We’ll see how this works next.</p>
<h3 id="Drawing-the-map"><a href="#Drawing-the-map" class="headerlink" title="Drawing the map"></a>Drawing the map</h3><p>Now that we have a map data structure and some basic information, we will use a <code>Screen</code> type to not only display the map, but to handle keyboard input as well.</p>
<p>A <code>Screen</code> type is a core concept in SadConsole. It represents something that receives input and can draw. A <code>Screen</code> can be a parent and/or a child of another <code>Screen</code>. In the case of our map, we’ll use a single screen to represent drawing the player and their surroundings.</p>
<p>Create another folder in the project named <code>Screens</code> and add a new class named <code>Dungeon.cs</code>. This screen will handle linking a drawing surface with the map tiles. The code for this screen is pretty simple; it inherits from <code>SadConsole.Screen</code>.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework;</span><br><span class="line"><span class="keyword">using</span> SadConsole.Renderers;</span><br><span class="line"><span class="keyword">using</span> SadConsole.Surfaces;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SadRogue.Screens</span></span><br><span class="line">&#123;</span><br><span class="line">    class Dungeon: SadConsole.Screen</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> SurfaceRenderer renderer = <span class="keyword">new</span> SurfaceRenderer();</span><br><span class="line">        <span class="keyword">private</span> BasicSurface surface;</span><br><span class="line">        <span class="keyword">private</span> SadConsole.DrawCallSurface drawCall;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Point MapViewPoint &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> surface.RenderArea.Location; &#125; <span class="keyword">set</span> &#123; surface.RenderArea = <span class="keyword">new</span> Rectangle(<span class="keyword">value</span>, <span class="keyword">new</span> Point(Width, Height)); &#125; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> Width &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> Height &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Dungeon</span>(<span class="params"><span class="keyword">int</span> screenX, <span class="keyword">int</span> screenY, <span class="keyword">int</span> screenWidth, <span class="keyword">int</span> screenHeight</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Position = <span class="keyword">new</span> Point(screenX, screenY);</span><br><span class="line">            Width = screenWidth;</span><br><span class="line">            Height = screenHeight;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadMap</span>(<span class="params">Map map</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// Create a surface for drawing. It uses the tiles from a map object.</span></span><br><span class="line">            surface = <span class="keyword">new</span> BasicSurface(map.Width, map.Height, map.Tiles, SadConsole.Global.FontDefault, <span class="keyword">new</span> Rectangle(<span class="number">0</span>, <span class="number">0</span>, Width, Height));</span><br><span class="line">            drawCall = <span class="keyword">new</span> SadConsole.DrawCallSurface(surface, position, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Draw</span>(<span class="params">TimeSpan timeElapsed</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            renderer.Render(surface);</span><br><span class="line">            SadConsole.Global.DrawCalls.Add(drawCall);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">base</span>.Draw(timeElapsed);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The first three variables in this class handle rendering, nothing exciting there. The next variable, <code>MapViewPoint</code>, handles determining (starting at the top-left of the map) what part of the map we render. If we draw the map on the physical screen in a size of <strong>60x20</strong>, and our map is <strong>100x100</strong> we need to support scrolling to the portion the player is at. This property handles controlling the map for that. </p>
<p>The <code>LoadMap</code> method takes a <code>Map</code> object and creates the <code>BasicSurface</code>, which is used in drawing.</p>
<h2 id="Coordinator-screen"><a href="#Coordinator-screen" class="headerlink" title="Coordinator screen"></a>Coordinator screen</h2><p>We can now create the master screen that represents the state the game is in as the player moves through the dungeon. In the <code>Screen</code> folder, add a new class named <code>Adventure.cs</code>. This screen will not draw anything directly, but will be used to group all child screens (only the <code>Dungeon</code> screen for now) together. This new screen will also handle keyboard input.</p>
<p>This class is a little more complex so we’ll build it piece-by-piece.</p>
<p>First start with the main declarations and variables. We’ll declare the player, map, map screen, and expose the <code>MapViewPoint</code> from the map screen.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SadRogue.Screens</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Represents the whole screen when you are adventuring in a town or dungeon.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Coordinates betwene child screens.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    class Adventure : SadConsole.Screen</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Map map;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Entities.Player Player;</span><br><span class="line">        <span class="keyword">public</span> Dungeon DungeonScreen;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Map Map &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> map; &#125; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Point MapViewPoint</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> DungeonScreen.MapViewPoint; &#125;</span><br><span class="line">            <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                DungeonScreen.MapViewPoint = <span class="keyword">value</span>;</span><br><span class="line">                SyncEntityOffset();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>Next, the constructor, which sets where on the screen the map screen will draw.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Adventure</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DungeonScreen = <span class="keyword">new</span> Dungeon(<span class="number">0</span>, <span class="number">0</span>, Program.ScreenWidth, Program.ScreenHeight);</span><br><span class="line"></span><br><span class="line">    Children.Add(DungeonScreen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now add the <code>LoadMap</code> method, which as the name says, loads a map. This method hooks the <code>map.Entities.CollectionChanged</code> method. We will use this to ensure that the dungeon screen knows about any entity the map object has. Next,, we tell the dungeon screen to load the map for drawing.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadMap</span>(<span class="params">Map map</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// If we had an old map, unhook this event</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.map != <span class="literal">null</span>)</span><br><span class="line">        map.Entities.CollectionChanged -= Entities_CollectionChanged;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Tell the dungeon screen to load this new map</span></span><br><span class="line">    DungeonScreen.LoadMap(map);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Anytime an entity is removed or added, we need to know about it</span></span><br><span class="line">    map.Entities.CollectionChanged += Entities_CollectionChanged;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.map = map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The code for the <code>Entities_CollectionChanged</code> method is uneventful, it just keeps the dungeon screen’s <code>Children</code> collection in sync with the entities the map has. When a <code>GameObject</code> (which the entities are based on) is added to the <code>Children</code> collection of a screen, it does two things. First, anytime the screen drawing physical screen position changes, the entities will adjust position along with it. And secondly, any time the screen is told to draw, all child objects are also drawn.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Entities_CollectionChanged</span>(<span class="params"><span class="keyword">object</span> sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (e.Action)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> System.Collections.Specialized.NotifyCollectionChangedAction.Add:</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> e.NewItems)</span><br><span class="line">                DungeonScreen.Children.Add((SadRogue.Entities.EntityBase)item);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> System.Collections.Specialized.NotifyCollectionChangedAction.Remove:</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> e.OldItems)</span><br><span class="line">                DungeonScreen.Children.Remove((SadRogue.Entities.EntityBase)item);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> System.Collections.Specialized.NotifyCollectionChangedAction.Replace:</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> e.NewItems)</span><br><span class="line">                DungeonScreen.Children.Add((SadRogue.Entities.EntityBase)item);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> e.OldItems)</span><br><span class="line">                DungeonScreen.Children.Remove((SadRogue.Entities.EntityBase)item);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> System.Collections.Specialized.NotifyCollectionChangedAction.Reset:</span><br><span class="line">            DungeonScreen.Children.Clear();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SyncEntityOffset();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SyncEntityOffset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> map.Entities)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Make sure that the entity draws based on the current map scrolling values</span></span><br><span class="line">        item.PositionOffset = <span class="keyword">new</span> Point(-DungeonScreen.MapViewPoint.X, -DungeonScreen.MapViewPoint.Y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The last method is the <code>Update</code> method. Here we will check for keyboard input and move the player accordingly.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">TimeSpan timeElapsed</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">base</span>.Update(timeElapsed);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Handle keyboard when this screen is being run</span></span><br><span class="line">            <span class="keyword">if</span> (SadConsole.Global.KeyboardState.IsKeyPressed(Microsoft.Xna.Framework.Input.Keys.Left))</span><br><span class="line">                Player.MoveBy(<span class="keyword">new</span> Point(<span class="number">-1</span>, <span class="number">0</span>), map);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (SadConsole.Global.KeyboardState.IsKeyPressed(Microsoft.Xna.Framework.Input.Keys.Right))</span><br><span class="line">                Player.MoveBy(<span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">0</span>), map);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (SadConsole.Global.KeyboardState.IsKeyPressed(Microsoft.Xna.Framework.Input.Keys.Up))</span><br><span class="line">                Player.MoveBy(<span class="keyword">new</span> Point(<span class="number">0</span>, <span class="number">-1</span>), map);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (SadConsole.Global.KeyboardState.IsKeyPressed(Microsoft.Xna.Framework.Input.Keys.Down))</span><br><span class="line">                Player.MoveBy(<span class="keyword">new</span> Point(<span class="number">0</span>, <span class="number">1</span>), map);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For reference, here are the methods defined by the class, and what they do:</p>
<table>
<thead>
<tr>
<th>Method/Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MapViewPoint</td>
<td>This property just forwards the map’s <code>MapViewPoint</code> property. It also calls <code>SyncEntities</code> which is important.</td>
</tr>
<tr>
<td>LoadMap</td>
<td>Tells the <code>DungeonScreen</code> to load the current map. Also hooks an event to know when an entity is removed or added.</td>
</tr>
<tr>
<td>Entities_CollectionChanged</td>
<td>Triggered when an entity is added or removed from the map. This method makes sure that the (Screen base class) <code>DungeonScreen.Children</code> is in sync with the entities. A screen automatically draws and updates any child in the <code>Children</code> collection.</td>
</tr>
<tr>
<td>SyncEntityOffset</td>
<td>Makes sure that each entity is drawn in the correct position based on the <code>MapViewPoint</code>. Any time the screen scrolls, this needs to be called.</td>
</tr>
<tr>
<td>Update</td>
<td>Handles game logic for this screen.</td>
</tr>
</tbody>
</table>
<h2 id="Hooking-it-all-up"><a href="#Hooking-it-all-up" class="headerlink" title="Hooking it all up"></a>Hooking it all up</h2><p>Finally, we need to make sure SadConsole knows about this screen. Back in <strong>Program.cs</strong>, add a static variable at the top (under <code>ScreenHeight/Width</code>) to represent the adventuring mode of the game.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Screens.Adventure AdventureScreen;</span><br></pre></td></tr></table></figure>
<p>Replace the code for the <code>Init</code> method with the following code.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Create the map</span></span><br><span class="line">    AdventureScreen = <span class="keyword">new</span> Screens.Adventure();</span><br><span class="line">    AdventureScreen.LoadMap(<span class="keyword">new</span> Map(<span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    AdventureScreen.Player = <span class="keyword">new</span> Entities.Player();</span><br><span class="line">    AdventureScreen.Player.Position = <span class="keyword">new</span> Point(<span class="number">13</span>, <span class="number">7</span>);</span><br><span class="line">    AdventureScreen.Map.Entities.Add(AdventureScreen.Player);</span><br><span class="line">    </span><br><span class="line">    SadConsole.Global.CurrentScreen.Children.Add(AdventureScreen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Run the project and you should see something similar to this.</p>
<p><img src="images/part2-basicmap.png" alt="@ character in a roguelike map"></p>
<p>You can move the character around with the arrow keys. However, you can walk right on top of the walls. Let’s fix that.</p>
<p>Open up the <code>Map.cs</code> file and add a new method to the map class: <code>IsTileWalkable</code>.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsTileWalkable</span>(<span class="params"><span class="keyword">int</span> x, <span class="keyword">int</span> y</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || x &gt;= Width || y &gt;= Height)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> !Tiles[y * Width + x].IsBlockingMove;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This method checks to see if the map data indicates a specific tile will block movement or not.</p>
<p>Open up the <code>Entities/EntityBase.cs</code> file and modify the <code>MoveBy</code> method to call the <code>map.IsTileWalkable</code> method.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveBy</span>(<span class="params">Point change, Map map</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newPosition = Position + change;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the map if we can move to this new position</span></span><br><span class="line">    <span class="keyword">if</span> (map.IsTileWalkable(newPosition.X, newPosition.Y))</span><br><span class="line">        Position = newPosition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now run the game and you’ll see that you can no longer walk through the walls!</p>
<h2 id="Closing-thoughts"><a href="#Closing-thoughts" class="headerlink" title="Closing thoughts"></a>Closing thoughts</h2><p>In this part of the series we created some map tile objects, a player entity, and a map. We displayed the map through a screen object, and we hooked up input to move our player around.</p>
<p>In the <a href="part-3---map-generation.html">next step</a> of the tutorial we’ll handle randomizing and scrolling the map.</p>
<p><a href="sadconsole-rogueliketutorial.zip">Download the source code for the entire series</a>.</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	

	</div> <!-- col-md-9/col-md-12 -->
		
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2018 Thraka
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
